<div class="processor-container">
  <app-header></app-header>

  <!-- Main section -->
  <main class="main-content">
    <!-- Original image -->
    <section class="image-box">
      <div class="image-box-header">
        <h3>Uploaded Image</h3>
      </div>
      <div class="image-content">
        <div class="image-area">
          <div class="image-placeholder">
            <img *ngIf="previewUrl && !isCropping" [src]="previewUrl" alt="Uploaded Image">
            <image-cropper
              *ngIf="isCropping"
              [imageBase64]="previewUrl"
              [maintainAspectRatio]="false"
              [resizeToWidth]="1000"
              [resizeToHeight]="1000"
              format="png"
              (imageCropped)="onImageCropped($event)">
            </image-cropper>
          </div>
          <!-- Reserve space for buttons always, only show when cropping -->
          <div class="crop-buttons" [ngClass]="{ 'hidden': !isCropping }">
            <button class="crop-btn" (click)="applyCrop()">Done</button>
            <button class="crop-btn" (click)="cancelCrop()">Cancel</button>
          </div>
        </div>
        <div class="file-info" *ngIf="uploadedFileName">
  <table class="info-table">
    <tr><td></td></tr>
    <tr><td></td></tr>
    <tr><td></td></tr>
    <tr><td></td></tr>
    <tr><td></td></tr>
    <tr><td></td></tr><tr><td></td></tr><tr><td></td></tr><tr><td></td></tr>
    <tr>
      <td><strong>Image Name:</strong></td>
      <td>{{ uploadedFileName }}</td>
    </tr>
    <tr>
      <td><strong>Dimensions:</strong></td>
      <td>{{ uploadedImageWidth }} x {{ uploadedImageHeight }} px</td>
    </tr>
    <tr>
      <td><strong>Image Size:</strong></td>
      <td>{{ uploadedFileSize }}</td>
    </tr>
  </table>
</div>
      </div>
      <!-- Rotate / Upscale / Crop buttons -->
      <div class="action-buttons upload-actions">
  <button class="btn" (click)="openRotatePopup()">Rotate</button>
  <button class="btn" (click)="openUpscalePopup()">Upscale</button>
  <button class="btn" (click)="startCrop()">Crop</button>
</div>
    </section>

    <!-- Divider -->
    <div class="divider"></div>

    <!-- Processed image -->
    <section class="image-box">
      <div class="image-box-header">
        <h3>Processed Image</h3>
        <i class="fa-solid fa-xmark" (click)="onClose()"></i>
      </div>
      <div class="image-content">
        <div class="file-info" *ngIf="processedFileSize">
  <table class="info-table">
    <tr><td></td></tr>
    <tr><td></td></tr>
    <tr><td></td></tr>
    <tr><td></td></tr>
    <tr><td></td></tr>
    <tr><td></td></tr><tr><td></td></tr><tr><td></td></tr><tr><td></td></tr>
    <tr>
      <td><strong>Image Name:</strong></td>
      <td>{{ processedFileName }}</td>
    </tr>
    <tr>
      <td><strong>Dimensions:</strong></td>
      <td>{{ processedImageWidth }} x {{ processedImageHeight }} px</td>
    </tr>
    <tr>
      <td><strong>Image Size:</strong></td>
      <td>{{ processedFileSize }}</td>
    </tr>
    <!-- Add more rows if needed -->
  </table>
</div>
        <div class="image-area">
          <div class="image-placeholder">
            <img *ngIf="croppedImage" [src]="croppedImage" alt="Processed Image" />
          </div>
        </div>
      </div>
<div class="action-buttons processed-actions">
  <div class="left-actions">
    <button class="btn" (click)="downloadImage()">Save</button>
  </div>
  <i class="fa-solid fa-download download-icon" (click)="downloadImage()"></i>
</div>

    </section>
  </main>

  <!-- Rotate Popup -->
  <div class="popup-overlay" *ngIf="showRotatePopup">
    <div class="popup">
      <h3>Select Rotate Option</h3>
      <select [(ngModel)]="rotateOption">
        <option value="90">Rotate 90째</option>
        <option value="-90">Rotate -90째</option>
        <option value="180">Rotate 180째</option>
        <option value="-180">Rotate -180째</option>
        <option value="flipH">Flip Horizontal</option>
        <option value="flipV">Flip Vertical</option>
      </select>
      <div class="popup-actions">
        <button class="btn" (click)="applyRotate()">Apply</button>
        <button class="btn" (click)="closeRotatePopup()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Upscale Popup -->
  <div class="popup-overlay" *ngIf="showUpscalePopup">
    <div class="popup">
      <h3>Select Upscale Factor</h3>
      <select [(ngModel)]="upscaleOption">
        <option value="1.5">1.5x</option>
        <option value="2">2x</option>
        <option value="3">3x</option>
        <option value="4">4x</option>
      </select>
      <div class="popup-actions">
        <button class="btn" (click)="applyUpscale()">Apply</button>
        <button class="btn" (click)="closeUpscalePopup()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Close Confirmation Popup -->
  <div class="popup-overlay" *ngIf="showClosePopup">
    <div class="popup">
      <h3>Are you sure?</h3>
      <p>All uploaded and processed data will be lost.</p>
      <div class="popup-actions">
        <button class="btn danger" (click)="confirmClose()">OK</button>
        <button class="btn" (click)="cancelClose()">Cancel</button>
      </div>
    </div>
  </div>
</div>